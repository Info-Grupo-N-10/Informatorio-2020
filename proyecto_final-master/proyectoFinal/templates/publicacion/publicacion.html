{% extends 'base.html' %}
{% load static %}



{% block contenido %}
<!--/ Intro Single star /-->
  <section class="intro-single">
    <div class="container">
      <div class="row">
        <div class="col-md-12 col-lg-8">
          <div class="title-single-box">
            <h1 class="title-single">{{publicacion.titulo}}</h1>
            <span class="color-text-a">{{publicacion.ubicacion}}</span>
          </div>
        </div>
        <div class="col-md-12 col-lg-4">
          <nav aria-label="breadcrumb" class="breadcrumb-box d-flex justify-content-lg-end">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="{% url 'home' %}">Home</a>
              </li>
              <li class="breadcrumb-item">
                <a href="{% url 'publicacion:propiedades' %}">Propiedades</a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                {{publicacion.tipo_inmueble}}
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </section>
  <!--/ Intro Single End /-->

  <!--/ Property Single Star /-->
  <section class="property-single nav-arrow-b">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div id="property-single-carousel" class="owl-carousel owl-arrow gallery-property">

            {% for m in publicacion.mostrarTodas %}
              <div class="carousel-item-b">
                <img style="text-align: center; margin-left: auto; margin-right: auto; width: 50%;" src= "{{m.img.url}}">
              </div>
            {% endfor %}

          </div>
          <div class="row justify-content-between">
            <div class="col-md-5 col-lg-4">
              <div class="property-price d-flex justify-content-center foo">
                <div class="card-header-c d-flex">
                  <div class="card-box-ico">
                    <span class="ion-money">$</span>
                  </div>
                  <div class="card-title-c align-self-center">
                    <h5 class="title-c">{{publicacion.precio}}</h5>
                  </div>
                </div>
              </div>
              <div class="property-summary">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="title-box-d section-t4">
                      <h3 class="title-d">Especificaciones</h3>
                    </div>
                  </div>
                </div>
                <div class="summary-list">
                  <ul class="list">
                    <li class="d-flex justify-content-between">
                      <strong>Direccion:</strong>
                      <span>{{publicacion.ubicacion}}</span>
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Tipo de Inmueble:</strong>
                      <span>{{publicacion.tipo_inmueble}}</span>
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Area:</strong>
                      <span>{{publicacion.superficie}}
                        <sup>2</sup>
                      </span>
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Camas:</strong>
                      <span>{{publicacion.habitaciones}}</span>
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Baños:</strong>
                      <span>{{publicacion.baños}}</span>
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Cochera:</strong>
                      {% if publicacion.cochera %}
                        <span>Si</span>
                      {% else %}
                        <span>No</span>
                      {% endif %}
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Patio:</strong>
                      {% if publicacion.patio %}
                        <span>Si</span>
                      {% else %}
                        <span>No</span>
                      {% endif %}
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Niños:</strong>
                      {% if publicacion.niños %}
                        <span>Si</span>
                      {% else %}
                        <span>No</span>
                      {% endif %}
                    </li>
                    <li class="d-flex justify-content-between">
                      <strong>Mascotas:</strong>
                      {% if publicacion.mascotas %}
                        <span>Si</span>
                      {% else %}
                        <span>No</span>
                      {% endif %}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-7 col-lg-7 section-md-t3">
              <div class="row">
                <div class="col-sm-12">
                  <div class="title-box-d">
                    <h3 class="title-d">Descripción</h3>
                  </div>
                </div>
              </div>
              <div class="property-description">
                <p class="description color-text-a">
                  {{publicacion.descripcion}}
                </p>
              </div>
              <div class="row section-t3">
                <div class="col-sm-12">
                  <div class="title-box-d">
                    <h3 class="title-d">Servicios Incluidos</h3>
                  </div>
                </div>
              </div>
              <div class="amenities-list color-text-a">
                <ul class="list-a no-margin">
                  {% for s in publicacion.servicios.all %}
                      <li>{{s}}</li><br>
                  {% endfor %}
                </ul>
              </div>
<!-- ------------------------------------ -->

              <div class="row section-t3">
                <div class="col-sm-12">
                  <div class="title-box-d">
                    <a href="{% url 'favoritos:favPerfil' %}">Ir a favoritos</a>
                  </div>
                </div>
              </div>

              {% if user.propietario %}
              <div class="row section-t3">
                <div class="col-6 col-sm-12">
                  <div class="title-box-d">
                    <a class="btn btn-b-n" href="{% url 'publicacion:editar' publicacion.publicacion_id %}">Editar Publicacion</a>
                  </div>
                </div>
                <div class="col-6 col-sm-12">
                  <form method= "POST" action="{% url 'publicacion:borrar' publicacion.publicacion_id %}">{% csrf_token %}
                    <button type="submit" class="btn btn-b-n">Eliminar Publicacion</button>
                  </form>
                </div>

              </div>
              {% endif %}
  

<!-- ------------------------------------ -->

              {% if user.is_authenticated %}
              <form method="POST">
                {% csrf_token %}
                <div class="col-6">
                  <div class="title-box-d">
                    <h3 class="title-d">Acciones</h3>
                  </div>
                  <div class= "amenities-list color-text-a Publicaciones" style="width: 100%;">

                    <i class="like far fa-heart fa-2x" data-type="favorito" data-id="{{publicacion.publicacion_id}}" data-action="marcador" style="color: #FFD300" style=""> No me gusta</i>

                    
              {% else %}
                        <i class="like fas fa-heart fa-2x" data-type="favorito" data-id="{{publicacion.publicacion_id}}" data-action="marcador"> Me gusta</i>
                    </div>
                  </div>
                </form>
                    
              {% endif %}

                <div class="col-6">
                  <div class="title-box-d">
                    <a class="btn btn-b-n" href="{% url 'favoritos:favPerfil' %}">Ver los favoritos</a>
                  </div>
                </div>

              {% if publicacion.usuario == request.user %}

              <div class="row section-t3">
                <div class="col-6 col-sm-12">
                  <div class="title-box-d">
                    <a class="btn btn-b-n" href="{% url 'publicacion:editar' publicacion.publicacion_id %}">Editar Publicacion</a>
                  </div>
                </div>
                <div class="col-6 col-sm-12">
                  <form method= "POST" action="{% url 'publicacion:borrar' publicacion.publicacion_id %}">{% csrf_token %}
                    <button type="submit" class="btn btn-b-n">Eliminar Publicacion</button>
                  </form>
                </div>

              </div>

              {% endif %}
              {% comment %}
              <!-- {% if user.propietario %}
              <div class="row section-t3">
                <div class="col-sm-12">
                  <div class="title-box-d">
                    <a class="btn btn-b-n" href="{% url 'publicacion:editar' publicacion.publicacion_id %}">Editar Publicacion</a>
                  </div>
                </div>
              </div>
              {% endif %}

              <form method= "POST" action="{% url 'publicacion:borrar' publicacion.publicacion_id %}">
                   <button type="submit" class="btn btn-b-n">Eliminar Publicación</button>
              </form -->
              {% endcomment %}
        </div>
          </div>
            </form>

                </div>
              </div>
              </div>
            </div>
          </div>
        </div>
        

        <div class="col-md-10 offset-md-1">
          <ul class="nav nav-pills-a nav-pills mb-3 section-t3" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="pills-video-tab" data-toggle="pill" href="#pills-video" role="tab"
                aria-controls="pills-video" aria-selected="true">Video</a>
            </li>
            {% comment %}
<!--             <li class="nav-item">
              <a class="nav-link" id="pills-plans-tab" data-toggle="pill" href="#pills-plans" role="tab" aria-controls="pills-plans"
                aria-selected="false">Floor Plans</a>
            </li> -->
            {% endcomment %}
            <li class="nav-item">
              <a class="nav-link" id="pills-map-tab" data-toggle="pill" href="#pills-map" role="tab" aria-controls="pills-map"
                aria-selected="false">Ubicación</a>
            </li>
          </ul>
          <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-video" role="tabpanel" aria-labelledby="pills-video-tab">
              <iframe src="https://player.vimeo.com/video/73221098" width="100%" height="460" frameborder="0"
                webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
            </div>
            <div class="tab-pane fade" id="pills-plans" role="tabpanel" aria-labelledby="pills-plans-tab">
              <img src="{% static 'img/plan2.jpg' %}" alt="" class="img-fluid">
            </div>
            <div class="tab-pane fade" id="pills-map" role="tabpanel" aria-labelledby="pills-map-tab">
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d28321.926481874558!2d-59.00032386981285!3d-27.46176143365441!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94450c62a6f5f70b%3A0xf03ac86511c2cd6d!2sResistencia%2C%20Chaco!5e0!3m2!1ses-419!2sar!4v1600661589464!5m2!1ses-419!2sar" width="100%" height="460" frameborder="0" style="border:0;" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row section-t3">
            <div class="col-sm-12">
              <div class="title-box-d">
                <h3 class="title-d">Contacta al Propietario</h3>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 col-lg-4">
              <img src="{% static 'img/agent-1.jpg' %}" alt="" class="img-fluid">
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="property-agent">
                <h4 class="title-agent">{{user.first_name}} {{user.last_name}}</h4>
                <p class="color-text-a">
                  {{user.getPerfil.descripcion}}
                </p>
                <ul class="list-unstyled">
                  <li class="d-flex justify-content-between">
                    <strong>Teléfono:</strong>
                    <span class="color-text-a">{{user.getPerfil.telefono}}</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <strong>Email:</strong>
                    <span class="color-text-a">{{user.email}}</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <strong>Instagram:</strong>
                    <span class="color-text-a">chicky_aguirre</span>
                  </li>
                </ul>
                <div class="socials-a">
                  <ul class="list-inline">
                    <li class="list-inline-item">
                      <a href="#">
                        <i class="fa fa-facebook" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li class="list-inline-item">
                      <a href="#">
                        <i class="fa fa-twitter" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li class="list-inline-item">
                      <a href="#">
                        <i class="fa fa-instagram" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li class="list-inline-item">
                      <a href="#">
                        <i class="fa fa-pinterest-p" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li class="list-inline-item">
                      <a href="#">
                        <i class="fa fa-dribbble" aria-hidden="true"></i>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </section>
  <!--/ Property Single End /-->


{% comment %}
<!-- <script type="text/javascript">
    const handler = () => {
    fetch("marcar/favorito/<int:pk>/marcador", {method: 'POST'}).then((response) => response.json()).then((data) => console.log(data))
    }
    document.getElementById("agregar").addEventListener("click", handler )
</script> -->


<!-- <script type="text/javascript">

  var xhr = new XMLHttpRequest();
  xhr.open("GET", 'marcar/favorito/<int:pk>/marcador', false);
  xhr.onload = // something
  document.getElementById("agregar").addEventListener("click",
      function() {xhr.send(data) return xhr.response},
      false
);
</script> -->
{% endcomment %}

  <script>

    var like = document.getElementsByClassName("like");
    for(var i=0; i<=like.length;i++){
      console.log(like[i]);

      like[i].addEventListener("click", function(){
        
        $(this).toggleClass("btn").toggleClass('btn');
        $(this).text(' No me gusta').text(' Me gusta');
        
       
      });
    }

  </script>



<script type="text/javascript">

    function crear_favorito(){
      console.log("Funcionando");
      var current = $(this);
      var type = current.data("type");
      var pk = current.data('id');
      var action = current.data('action');
    
    
      $.ajax({
        url : "/Favoritos/marcar/" + type + "/" + pk + "/" + action + "/",
        type : "GET",
        date : {'objeto' : pk},

        success : function(json){
          console.log(json)

          }

      });
      return false;
    }

    $(function(){
      $('[data-action="marcador"]').click(crear_favorito)
    });

</script>


{% endblock %}